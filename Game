/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Pokemon;

import chatmessage.AnotherMessage;
import chatmessage.Message;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.net.Socket;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JFrame;

/**
 *
 * @author lenovo
 */
class Game extends JFrame implements Runnable, KeyListener{
    private MyJPanel panel;
    private Socket socket;
    private String[] alClients = new String[10];
    String username = null;
    String newuser = null;
    int statenewuser=0;
    int stateAwal = 0;
    Message objMsg = new Message();
    private boolean done;
    ThreadRead tr;
    PokemonGUI gui;
    public int x;
    public int y;
    public int x1;
    public int x2;

    Game(Socket socket, ThreadRead tr, String Username, PokemonGUI aThis) throws IOException{
        super();
        this.socket = socket;
        panel = new MyJPanel();
        this.tr = tr;
        add(panel);
        pack();
        addKeyListener(this);
        repaint();
        this.username = Username;
        this.gui=aThis;
    }

    @Override
    public void run() {
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setVisible(true);
        setTitle("Test");
        while(true){
            //System.out.println(tr.statenewuser);
            if(tr.statenewuser == 1){
                System.out.println("masukstate");
                for(int i = 0; i < 10; i++){
                    if(alClients[i]==null){
                        System.out.println("tambahUser");
                        alClients[i]=tr.newuser;
                        System.out.println(alClients[i]);
                        panel.newUser(i);
                        break;
                    }
                }
                tr.statenewuser = 0;
                repaint();
            }
            panel.x1[0] = tr.x;
            panel.x2[0] = tr.y;
            x1 = tr.x;
            x2 = tr.y;
            repaint();
        }
    }
    @Override
    public void repaint() {
        super.repaint();
    }

    @Override
    public void keyPressed(KeyEvent e) {
        panel.keyPressed(e);
        repaint();
        try {
            String msg = "x: " + panel.getX() + " y: " + panel.getY() ;
            Message objMsg = new Message();
            objMsg.setMessage(msg);
            objMsg.setSender(username);
            tr.send(objMsg);
        } catch (IOException ex) {
            Logger.getLogger(PokemonGUI.class.getName()).log(Level.SEVERE, null, ex);
        }
        x = panel.getX();
        y = panel.getY();
    }

    @Override
    public void keyTyped(KeyEvent e) { }

    @Override
    public void keyReleased(KeyEvent e) { }
     
}
